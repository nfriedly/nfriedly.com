<!DOCTYPE html>
<html lang="en">
<head>
<title>How Facebook sets and uses cross-domain cookies</title>


    <!--[if lt IE 9]><script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/r29/html5.min.js"></script><![endif]-->


<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="generator" content="DocPad v6.79.0" />
<link rel="canonical" href="http://nfriedly.com/techblog/2010/08/how-facebook-sets-and-uses-cross-domain-cookies/" />


<script>
function loadBackupCSS(url) {
	var l = document.createElement('link');
	l.rel = 'stylesheet';
	l.href = url;
	document.head.appendChild(l);
}
</script>
<link href='http://fonts.googleapis.com/css?family=Raleway:400,400italic,700' rel='stylesheet' type='text/css'>
<link href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" rel="stylesheet" onerror="loadBackupCSS('/bower_components/bootstrap/dist/css/bootstrap.min.css')">
<link href="//maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" onerror="loadBackupCSS('/bower_components/font-awesome/css/font-awesome.min.css')">

<link  rel="stylesheet" href="/styles/styles.css" />

<link rel="openid2.provider" href="https://openid.stackexchange.com/openid/provider">
<link rel="openid2.local_id" href="https://openid.stackexchange.com/user/4dbfb008-6890-4127-8778-d8bcd0031195"> 

</head>
<body class="post">

<div class="over-footer">


<nav class="navbar navbar-inverse navbar-static-top">
	<div class="container">
		<div class="navbar-header">
			<button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#nav-menu" aria-expanded="false" aria-controls="navbar">
				<span class="sr-only">Toggle navigation</span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
			</button>
			<a class="navbar-brand" href="/">Nathan Friedly</a>
		</div>
		<div id="nav-menu" class="collapse navbar-collapse">
			<ul class="nav navbar-nav">
				<li ><a href="/"><i class="fa fa-home"></i> Home</a></li>
				<li ><a href="/about/"><i class="fa fa-android"></i> About</a></li>
				<li ><a href="/portfolio/"><i class="fa fa-laptop"></i> Portfolio</a></li>
				<li ><a href="/techblog/"><i class="fa fa-terminal"></i> Tech blog</a></li>
			</ul>
		</div>
	</div>
</nav>


<header class="jumbotron" style="background-image: url(http://farm9.staticflickr.com/8184/8441826101_551240bc4f_b.jpg);">
	<div class="container">
		<h1><a href="/techblog/2010/08/how-facebook-sets-and-uses-cross-domain-cookies/"> How Facebook sets and uses cross-domain cookies</a></h1>
		
	</div>
</header>


<main class="container">
<p><img class="alignleft" alt="" src="http://nfriedly.com/img/portfolio/facebook.png" />I&#8217;ve seen a lot of confusion about this lately, so I thought I&#8217;d make a quick writeup to explain how facebook does it. (I&#8217;ll also give a quick tip on how you can do it yourself.)</p>
<h3 id="what-facebook-does">What Facebook Does</h3>
<p>Facebook is in a unique position compared to many developers looking to set cross domain cookies: The user visits both facebook.com and the other website.</p>
<!--more-->
<p><img src="http://farm9.staticflickr.com/8456/7890051894_64a3a7796f.jpg" alt="Picture frames" title="Framed!" class="right" /> Facebook never actually sets cookies cross-domain, they only read cookies cross-domain. They set cookies on facebook.com when the user visits facebook.com and they set cookies on the other example.com (or any other website) when the user visits example.com.<sup><a href="#note-1">1</a></sup></p>
<p>Doing things this way avoids all of the browser security issues because cookies that were already set when the user visited facebook.com can still be read when example.com loads facebook.com in an iframe. This is worth repeating: <strong>Cookies can be read in an iframe if they were set outside of the iframe</strong>.<sup><a href="#note-2">2</a></sup></p>
<h3 id="what-about-when-the-user-is-not-logged-into-facebook-">What about when the user is not logged into Facebook?</h3>
<p><strong>(This is how you can do it!)</strong></p>
<p>If the user is not logged into Facebook when trying to use Facebook on example.com, then Facebook opens a popup window &#8211; not an iframe &#8211; to let the user log in.</p>
<p>A popup window has none of the cookie restrictions that iframes get; it can read and set cookies normally.</p>
<h3 id="what-about-popup-blockers-">What about popup blockers?</h3>
<p>Most popup blockers make a special exception for &#8220;intentional&#8221; popups &#8211; ones that occur as a direct result of a user&#8217;s click. When the user clicks the login button, the blocker allows the popup because the click indicates that the user wanted that popup.</p>
<h3 id="cross-domain-communication">Cross-domain communication</h3>
<p>If you need to communicate between domains, <a href="http://caniuse.com/#feat=x-doc-messaging">modern browsers</a> allow you to use <a href="https://developer.mozilla.org/en-US/docs/DOM/window.postMessage">postMessage</a> to send data between web pages (although it <a href="http://blogs.msdn.com/b/ieinternals/archive/2009/09/16/bugs-in-ie8-support-for-html5-postmessage-sessionstorage-and-localstorage.aspx">doesn&#8217;t work with popups in Internet Explorer</a>).</p>
<p>If you need to support older browsers, you can include the excellent <a href="http://easyxdm.net/">easyXDM</a> library for iframe-parent communication. You might need to combine a popup + one or more iframes in some situations.</p>
<h3 id="an-alternate-method-for-of-cross-domain-cookies-flash-img-src-http-farm5-staticflickr-com-4063-4698846940_7043976b6f_n-jpg-alt-the-flash-class-right-">An alternate method for of cross-domain cookies: flash <img src="http://farm5.staticflickr.com/4063/4698846940_7043976b6f_n.jpg" alt="THE Flash" class="right"></h3>
<p>If you&#8217;re looking for a flash-based method of setting cross-domain cookies, or would otherwise like to avoid popups, you may want to check out my previous article, which includes source code: <a href="http://nfriedly.com/techblog/2010/07/swf-for-javascript-cross-domain-flash-cookies/">.swf for JavaScript cross-domain flash cookies</a></p>
<h3 id="notes">Notes</h3>
<ol>
<li><a name="note-1"></a>Cookies are only set on example.com when using the using <a href="http://developers.facebook.com/docs/reference/javascript/">Facebook&#8217;s JavaScript SDK</a>. When embedding Social plugins directly as an iframe, only facebook.com cookies are used.</li>
<li><a name="note-2"></a>Safari sometimes prevents JavaScript from reading cookies in an iframe even if GET and POST requests to the server have full access to the cookies. Safari has several quirks like this, but generally <a href="http://anantgarg.com/2010/02/18/cross-domain-cookies-in-safari/">behaves better with iframes if the user <em>interacts</em> with it</a>.</li>
</ol>
<h2 id="need-a-more-advanced-integration-than-what-facebook-social-plugins-provide-">Need a more advanced integration than what Facebook Social Plugins provide?</h2>
<p>At <a href="http://sociablelabs.com">Sociable Labs</a>, our Intelligent Social Plugins<sup>TM</sup> increase social sharing by 15x and have shown a ~1% increase in sales. And the best part is that <a href="http://www.sociablelabs.com/product.html">we do all of the hard work for you!</a></p>
<p class="meta"><small class="photocredits"><b>Photo Credits:</b> 
Gorge du Verdon photo by <a href="http://www.flickr.com/photos/73886193@N06/8441826101/in/photostream/">Eksley</a>,
Picture frames photo by <a href="http://www.flickr.com/photos/elsie/7890051894/">Elsie esq.</a>,
Flash photo by <a href="http://www.flickr.com/photos/jdhancock/4698846940/">JD Hancock</a></small></p>




</main>

</div> <!-- .over-footer -->

<footer>
	<div class="container">
		<div class="row">
			<div class="col-md-5 contact">
				<h3>Contact Nathan</h3>
				
				<ul>
					<li>
						<a class="email">
							<span class="fa-stack">
								<i class="fa fa-square-o fa-stack-2x"></i>
								<i class="fa fa-envelope fa-stack-1x"></i>
							</span>
							<span class="email-text">nathan @ (this website)</span>
						</a>
					</li>
					<li>
						<a class="fa-stack" href="https://github.com/nfriedly">
							<i class="fa fa-square-o fa-stack-2x"></i>
							<i class="fa fa-github fa-stack-1x"></i>
						</a>
					</li>
					<li>
						<a class="fa-stack" href="http://stackoverflow.com/users/933879/nathan-friedly">
							<i class="fa fa-square-o fa-stack-2x"></i>
							<i class="fa fa-stack-overflow fa-stack-1x"></i>
						</a>
					</li>
					<li>
						<a class="fa-stack" href="https://www.linkedin.com/in/nathanfriedly">
							<i class="fa fa-square-o fa-stack-2x"></i>
							<i class="fa fa-linkedin fa-stack-1x"></i>
						</a>
					</li>
					<li>
						<a class="fa-stack" href="https://www.facebook.com/nfriedly">
							<i class="fa fa-square-o fa-stack-2x"></i>
							<i class="fa fa-facebook fa-stack-1x"></i>
						</a>
					</li>
					<li>
						<a class="fa-stack" href="https://twitter.com/nfriedly">
							<i class="fa fa-square-o fa-stack-2x"></i>
							<i class="fa fa-twitter fa-stack-1x"></i>
						</a>
					</li>
					<li>
						<a class="fa-stack" href="https://plus.google.com/+NathanFriedly">
							<i class="fa fa-square-o fa-stack-2x"></i>
							<i class="fa fa-google-plus fa-stack-1x"></i>
						</a>
					</li>
					<li>
						<a class="fa-stack" href="http://steamcommunity.com/id/nfriedly">
							<i class="fa fa-square-o fa-stack-2x"></i>
							<i class="fa fa-steam fa-stack-1x"></i>
						</a>
					</li>
					<li>
						<a class="fa-stack" href="https://news.ycombinator.com/user?id=nfriedly">
							<i class="fa fa-square-o fa-stack-2x"></i>
							<i class="fa fa-yc fa-stack-1x"></i>
						</a>
					</li>
				</ul>
			</div>
			
			<div class="col-md-3 sitemap">
				<h3>Site Map</h3>
				<ul class="fa-ul">
					<li><a href="/"><i class="fa-li fa fa-home"></i> Home</a></li>
					<li><a href="/about/"><i class="fa-li fa fa-android"></i>About</a></li>
					<li><a href="/portfolio/"><i class="fa-li fa fa-laptop"></i>Portfolio</a></li>
					<li><a href="/techblog/"><i class="fa-li fa fa-terminal"></i>Tech blog</a></li>
				</ul>
			</div>
			
			<div class="col-md-4 info">
				<p>&copy; Nathan Friedly 2017</p>
				<p><a rel="license" href="http://creativecommons.org/licenses/by/3.0/deed.en_US"><img alt="Creative Commons License" style="border-width:0" src="http://i.creativecommons.org/l/by/3.0/88x31.png" class="pull-left" /></a> Content licensed under <a rel="license" href="http://creativecommons.org/licenses/by/3.0/deed.en_US">Creative Commons Attribution</a>.</p>
				<p><a href="https://github.com/nfriedly/nfriedly.com"><i class="fa fa-github"></i> Source code available on Github</a> under a <a href="http://opensource.org/licenses/MIT">MIT License</a></p>
				
				<p>Built with <a href="http://docpad.org">DocPad</a>, 
					<a href="http://getbootstrap.com/">Bootstrap</a>, 
					and <a href="http://www.nodejs.org/">Node.js</a>.
				</p>
			</div>
		</div>
	</div>
</footer>
<div class="chromefix"></div>

<script>
function loadBackupJS(url) {
	var s = document.createElement('script');
	s.src = url;
	document.head.appendChild(s);
}
</script>


	<!--[if lt IE 9]>
		<script src="//cdnjs.cloudflare.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
	<![endif]-->
	<!--[if gte IE 9]><!-->
	<script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js" onerror="loadBackupJS('/bower_components/jquery/dist/jquery.min.js')"></script>
	<!--<![endif]-->
	<script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" defer></script>
	<script src="//cdnjs.cloudflare.com/ajax/libs/lodash.js/2.4.1/lodash.min.js" onerror="loadBackupJS('/bower_components/lodash/dist/lodash.min.js')"></script>


<script defer="defer"  src="/scripts/email.js"></script>



	<script type="text/javascript">
      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-1735765-3']);
      _gaq.push(['_trackPageview']);
      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();
    </script>



</body>
</html>
